<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../static/css/global.css">
        <title>Document</title>
</head>
<body>
    <h1 class="title">BITE<span id="i-color">BUZZ</span></h1>

    <div class="tabs">
        <button class="tab-button" id="yellow-tab">tab 1</button>
        <button class="tab-button" id="red-tab">tab 2</button>
        <button class="tab-button" id="blue-tab">about</button>
    </div>

    <div class="main">
        <!-- <div class="cog-class">
            <svg id="cog-svg">
                <use href="../static/images/icons.svg#cog"/>
            </svg>
        </div> -->

        <!-- <textarea class="text-box" name="text-box"
            placeholder="Paste your review here"></textarea>

        <div class="button-class">
            <button id="submit-button">click</button>
        </div> -->
        <!-- i commented the above out to replace w the mic stuff -->

        <button id="record-btn">start recording</button>
        <button id="submit-btn" disabled>submit review</button>
        <button id="new-review" style="display:none;">record another review</button>
        <div id="preview"></div>

    </div>

    <div class="red-main">
        <!-- <div class="cog-class">
            <svg id="cog-svg">
                <use href="../static/images/icons.svg#cog"/>
            </svg>
        </div> -->

        <textarea class="text-box" name="text-box"
            placeholder="Paste your review here"></textarea>

       
    </div>

    <div class="blue-main">
        <!-- <div class="cog-class">
            <svg id="cog-svg">
                <use href="../static/images/icons.svg#cog"/>
            </svg>
        </div> -->

        <div>
            <p>The hospitality industry lacks a reliable way to gauge accurate customer feedback. 
                Questionnaires and forms left at restaurants regularly go ignored, and reviews written online hours after the meal lack objectivity. </p> <br>
            <p>Bitebuzz fills this gap; revolutionizing the dining sector with an innovative new option for telling businesses what they really think. </p> <br>
            <p>With Bitebuzz, customers have an easy way to quickly give the restaurant their thoughts! Through microphone kiosks strategically placed 
                outside the exits of restaurants, satisfied or unsatisfied diners can quickly record their thoughts which can then be instantaneously processed to provide businesses with fresh and actionable insight on customer satisfaction.
                Once a customer leaves the restaurant, they can quickly turn into the Bitebuzz kiosk to get their thoughts out from the moment they leave the restaurant. 
                After recording their opinions, the audio is processed into text that is collected so that our machine learning client can generate suggestions for the business to improve.</p>
        </div>

       
    </div>



    <div class="popup-bg">
        <div class="popup-box">
            <img id="popup" draggable="false" src="../static/images/bigrips.svg" alt="">
            <div style="z-index: 99999;">hallllooooooooo</div>
            <button id="close-button">close</button>
        </div>
        
        <!-- <svg id="popup">
            <use href="../static/images/icons.svg#bigrips"/>
        </svg> -->
    </div>

    <div>whaddup</div>

</body>
<script>
    const popupBg = document.querySelector(".popup-bg")
    const popup = document.getElementById("popup")
    const popupDiv = document.querySelector(".popup-box")
    const closeButton = document.getElementById("close-button")

    const yellowTab = document.getElementById("yellow-tab")
    const redTab = document.getElementById("red-tab")
    const blueTab = document.getElementById("blue-tab")

    const yellowMain = document.querySelector(".main")
    const redMain = document.querySelector(".red-main")
    const blueMain = document.querySelector(".blue-main")

    const recordBtn = document.getElementById('record-btn')
    const submitBtn = document.getElementById('submit-btn')
    const newReviewBtn = document.getElementById('new-review')
    const preview = document.getElementById('preview')

    let isRecording = false
    let recognition
    let transcriptText = ''

    if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition()
        recognition.continuous = false
        recognition.lang = 'en-US'
        recognition.interimResults = false

        recognition.onresult = (event) => {
            transcriptText = event.results[0][0].transcript
            preview.textContent = transcriptText
            submitBtn.disabled = false
        }

        recognition.onerror = (event) => {
            console.error("Speech recognition error:", event.error)
            preview.textContent = "Error: " + event.error
        }

        recordBtn.addEventListener('click', () => {
            if (!isRecording) {
                recognition.start()
                recordBtn.textContent = "stop recording"
            } else {
                recognition.stop()
                recordBtn.textContent = "start recording"
            }
            isRecording = !isRecording
        })
    } else {
        recordBtn.disabled = true
        preview.textContent = "Speech recognition not supported in this browser."
    }

    submitBtn.addEventListener('click', async () => {
        if (!transcriptText) return

        const response = await fetch('/submit', {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: transcriptText })
        })

        const data = await response.json()
        console.log("Submitted review with ID:", data.id)

        preview.textContent = "review submitted!"
        submitBtn.disabled = true
        recordBtn.disabled = true
        newReviewBtn.style.display = 'inline-block'
    })

    newReviewBtn.addEventListener('click', () => {
        transcriptText = ''
        preview.textContent = ''
        recordBtn.disabled = false
        submitBtn.disabled = true
        newReviewBtn.style.display = 'none'
        recordBtn.textContent = "start recording"
    })

    // don't touch
    popupBg.addEventListener("click", (e) => {
        const isClickInside = popupDiv.contains(e.target)
        if (!isClickInside){
            popupBg.style.visibility = 'hidden'
        }
    })

    closeButton.addEventListener("click", () => {
        popupBg.style.visibility = 'hidden'
    })

    redTab.addEventListener("click", () =>{
        yellowMain.style.display = 'none'
        blueMain.style.display = 'none'
        redMain.style.display = 'grid'
    })

    yellowTab.addEventListener("click", () =>{
        redMain.style.display = 'none'
        blueMain.style.display = 'none'
        yellowMain.style.display = 'grid'
    })

    blueTab.addEventListener("click", () =>{
        redMain.style.display = 'none'
        yellowMain.style.display = 'none'
        blueMain.style.display = 'grid'
    })
</script>
</html>