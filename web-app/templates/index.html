<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../static/css/global.css">
        <title>Document</title>
</head>
<body>
    <h1 class="title">BITE<span id="i-color">BUZZ</span></h1>

    <div class="tabs">
        <button class="tab-button" id="yellow-tab">tab 1</button>
        <button class="tab-button" id="red-tab">tab 2</button>
        <button class="tab-button" id="blue-tab">about</button>
    </div>

    <div class="main">
        <!-- <div class="cog-class">
            <svg id="cog-svg">
                <use href="../static/images/icons.svg#cog"/>
            </svg>
        </div> -->

        <textarea class="text-box" name="text-box"
            placeholder="Paste your review here"></textarea>

        <div class="button-class">
            <button id="submit-button">click</button>
        </div>

       
    </div>

    <div class="red-main">
        <!-- <div class="cog-class">
            <svg id="cog-svg">
                <use href="../static/images/icons.svg#cog"/>
            </svg>
        </div> -->

        <textarea class="text-box" name="text-box"
            placeholder="Paste your review here"></textarea>

       
    </div>

    <div class="blue-main">
        <!-- <div class="cog-class">
            <svg id="cog-svg">
                <use href="../static/images/icons.svg#cog"/>
            </svg>
        </div> -->

        <div>
            <p>hello</p>
        </div>

       
    </div>



    <div class="popup-bg">
        <div class="popup-box">
            <img id="popup" draggable="false" src="../static/images/bigrips.svg" alt="">
            <div style="z-index: 99999;">hallllooooooooo</div>
            <button id="close-button">close</button>
        </div>
        
        <!-- <svg id="popup">
            <use href="../static/images/icons.svg#bigrips"/>
        </svg> -->
    </div>

    <div>whaddup</div>

</body>
<script>
    const submitButton = document.getElementById("submit-button")
    const popupBg = document.querySelector(".popup-bg")
    const popup = document.getElementById("popup")
    const popupDiv = document.querySelector(".popup-box")
    const closeButton = document.getElementById("close-button")

    const yellowTab = document.getElementById("yellow-tab")
    const redTab = document.getElementById("red-tab")
    const blueTab = document.getElementById("blue-tab")

    const yellowMain = document.querySelector(".main")
    const redMain = document.querySelector(".red-main")
    const blueMain = document.querySelector(".blue-main")

    const textBox = document.querySelector(".text-box")

    // edited this
    submitButton.addEventListener("click", async () => {
        const reviewText = textBox.value
        if (!reviewText) {
            alert("Please enter a review first!")
            return
        }

        // Submit the review
        const response = await fetch("/submit", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ text: reviewText })
        })
        const data = await response.json()
        const reviewId = data.id

        // Poll for result every 2 seconds
        const poll = setInterval(async () => {
            const res = await fetch(`/result/${reviewId}`)
            if (res.status === 200) {
                const resultData = await res.json()
                popupDiv.innerHTML = `
                    <p><strong>Sentiment:</strong> ${resultData.sentiment}</p>
                    <p><strong>Suggestion:</strong> ${resultData.suggestion}</p>
                    <p><strong>Category:</strong> ${resultData.category}</p>
                    <p><strong>Polarity:</strong> ${resultData.polarity}</p>
                    <p><strong>Subjectivity:</strong> ${resultData.subjectivity}</p>
                    <button id="close-button">close</button>
                `
                popupBg.style.visibility = 'visible'
                clearInterval(poll)

                document.getElementById("close-button").addEventListener("click", () => {
                    popupBg.style.visibility = 'hidden'
                })

            } else if (res.status !== 202) {
                console.error("Unexpected response")
                clearInterval(poll)
            }
        }, 2000)
    })

    popupBg.addEventListener("click", (e) => {
        const isClickInside = popupDiv.contains(e.target)

        if (!isClickInside){
            popupBg.style.visibility = 'hidden'
        }
    })

    closeButton.addEventListener("click", () => {
        popupBg.style.visibility = 'hidden'
    })

    redTab.addEventListener("click", () =>{
        yellowMain.style.display = 'none'
        blueMain.style.display = 'none'
        redMain.style.display = 'grid'

    })

    yellowTab.addEventListener("click", () =>{
        redMain.style.display = 'none'
        blueMain.style.display = 'none'
        yellowMain.style.display = 'grid'

    })

    blueTab.addEventListener("click", () =>{
        redMain.style.display = 'none'
        yellowMain.style.display = 'none'
        blueMain.style.display = 'grid'

    })
</script>
</html>